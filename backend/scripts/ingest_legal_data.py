"""
ë²•ë¥  ë°ì´í„°ë¥¼ Google File Searchì— ì—…ë¡œë“œí•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸.

Phase 6: backend-rag êµ¬í˜„.

Run: python -m scripts.ingest_legal_data
"""

import asyncio
import sys
from datetime import date
from pathlib import Path

# Add parent directory to path for imports
sys.path.insert(0, str(Path(__file__).parent.parent))

from app.services.llm.rag_service import RAGService, get_rag_service
from app.schemas.legal_document import (
    LegalDocumentType,
    LegalDocumentMetadata,
    LegalCategory,
    CourtType,
)


async def ingest_civil_code(rag: RAGService) -> int:
    """
    ë¯¼ë²• ì£¼ìš” ì¡°ë¬¸ ì—…ë¡œë“œ.

    Returns:
        ì—…ë¡œë“œëœ ì¡°ë¬¸ ìˆ˜
    """
    articles = [
        {
            "number": "ì œ2ì¡°",
            "title": "ì‹ ì˜ì„±ì‹¤",
            "content": """â‘  ê¶Œë¦¬ì˜ í–‰ì‚¬ì™€ ì˜ë¬´ì˜ ì´í–‰ì€ ì‹ ì˜ì— ì¢‡ì•„ ì„±ì‹¤íˆ í•˜ì—¬ì•¼ í•œë‹¤.
â‘¡ ê¶Œë¦¬ëŠ” ë‚¨ìš©í•˜ì§€ ëª»í•œë‹¤.""",
        },
        {
            "number": "ì œ103ì¡°",
            "title": "ë°˜ì‚¬íšŒì§ˆì„œì˜ ë²•ë¥ í–‰ìœ„",
            "content": """ì„ ëŸ‰í•œ í’ì† ê¸°íƒ€ ì‚¬íšŒì§ˆì„œì— ìœ„ë°˜í•œ ì‚¬í•­ì„ ë‚´ìš©ìœ¼ë¡œ í•˜ëŠ” ë²•ë¥ í–‰ìœ„ëŠ” ë¬´íš¨ë¡œ í•œë‹¤.""",
        },
        {
            "number": "ì œ104ì¡°",
            "title": "ë¶ˆê³µì •í•œ ë²•ë¥ í–‰ìœ„",
            "content": """ë‹¹ì‚¬ìì˜ ê¶ë°•, ê²½ì†” ë˜ëŠ” ë¬´ê²½í—˜ìœ¼ë¡œ ì¸í•˜ì—¬ í˜„ì €í•˜ê²Œ ê³µì •ì„ ìƒì€ ë²•ë¥ í–‰ìœ„ëŠ” ë¬´íš¨ë¡œ í•œë‹¤.""",
        },
        {
            "number": "ì œ390ì¡°",
            "title": "ì±„ë¬´ë¶ˆì´í–‰ê³¼ ì†í•´ë°°ìƒ",
            "content": """ì±„ë¬´ìê°€ ì±„ë¬´ì˜ ë‚´ìš©ì— ì¢‡ì€ ì´í–‰ì„ í•˜ì§€ ì•„ë‹ˆí•œ ë•Œì—ëŠ” ì±„ê¶ŒìëŠ” ì†í•´ë°°ìƒì„ ì²­êµ¬í•  ìˆ˜ ìˆë‹¤.
ê·¸ëŸ¬ë‚˜ ì±„ë¬´ìì˜ ê³ ì˜ë‚˜ ê³¼ì‹¤ì—†ì´ ì´í–‰í•  ìˆ˜ ì—†ê²Œ ëœ ë•Œì—ëŠ” ê·¸ëŸ¬í•˜ì§€ ì•„ë‹ˆí•˜ë‹¤.""",
        },
        {
            "number": "ì œ393ì¡°",
            "title": "ì†í•´ë°°ìƒì˜ ë²”ìœ„",
            "content": """â‘  ì±„ë¬´ë¶ˆì´í–‰ìœ¼ë¡œ ì¸í•œ ì†í•´ë°°ìƒì€ í†µìƒì˜ ì†í•´ë¥¼ ê·¸ í•œë„ë¡œ í•œë‹¤.
â‘¡ íŠ¹ë³„í•œ ì‚¬ì •ìœ¼ë¡œ ì¸í•œ ì†í•´ëŠ” ì±„ë¬´ìê°€ ê·¸ ì‚¬ì •ì„ ì•Œì•˜ê±°ë‚˜ ì•Œ ìˆ˜ ìˆì—ˆì„ ë•Œì— í•œí•˜ì—¬ ë°°ìƒì˜ ì±…ì„ì´ ìˆë‹¤.""",
        },
        {
            "number": "ì œ750ì¡°",
            "title": "ë¶ˆë²•í–‰ìœ„ì˜ ë‚´ìš©",
            "content": """ê³ ì˜ ë˜ëŠ” ê³¼ì‹¤ë¡œ ì¸í•œ ìœ„ë²•í–‰ìœ„ë¡œ íƒ€ì¸ì—ê²Œ ì†í•´ë¥¼ ê°€í•œ ìëŠ” ê·¸ ì†í•´ë¥¼ ë°°ìƒí•  ì±…ì„ì´ ìˆë‹¤.""",
        },
        {
            "number": "ì œ751ì¡°",
            "title": "ì¬ì‚° ì´ì™¸ì˜ ì†í•´ì˜ ë°°ìƒ",
            "content": """â‘  íƒ€ì¸ì˜ ì‹ ì²´, ììœ  ë˜ëŠ” ëª…ì˜ˆë¥¼ í•´í•˜ê±°ë‚˜ ê¸°íƒ€ ì •ì‹ ìƒê³ í†µì„ ê°€í•œ ìëŠ” ì¬ì‚° ì´ì™¸ì˜ ì†í•´ì— ëŒ€í•˜ì—¬ë„ ë°°ìƒí•  ì±…ì„ì´ ìˆë‹¤.
â‘¡ ë²•ì›ì€ ì „í•­ì˜ ì†í•´ë°°ìƒì„ ì •ê¸°ê¸ˆì±„ë¬´ë¡œ ì§€ê¸‰í•  ê²ƒì„ ëª…í•  ìˆ˜ ìˆê³  ê·¸ ì´í–‰ì„ í™•ë³´í•˜ê¸° ìœ„í•˜ì—¬ ìƒë‹¹í•œ ë‹´ë³´ì˜ ì œê³µì„ ëª…í•  ìˆ˜ ìˆë‹¤.""",
        },
        {
            "number": "ì œ756ì¡°",
            "title": "ì‚¬ìš©ìì˜ ë°°ìƒì±…ì„",
            "content": """â‘  íƒ€ì¸ì„ ì‚¬ìš©í•˜ì—¬ ì–´ëŠ ì‚¬ë¬´ì— ì¢…ì‚¬í•˜ê²Œ í•œ ìëŠ” í”¼ìš©ìê°€ ê·¸ ì‚¬ë¬´ì§‘í–‰ì— ê´€í•˜ì—¬ ì œì‚¼ìì—ê²Œ ê°€í•œ ì†í•´ë¥¼ ë°°ìƒí•  ì±…ì„ì´ ìˆë‹¤.
ê·¸ëŸ¬ë‚˜ ì‚¬ìš©ìê°€ í”¼ìš©ìì˜ ì„ ì„ ë° ê·¸ ì‚¬ë¬´ê°ë…ì— ìƒë‹¹í•œ ì£¼ì˜ë¥¼ í•œ ë•Œ ë˜ëŠ” ìƒë‹¹í•œ ì£¼ì˜ë¥¼ í•˜ì—¬ë„ ì†í•´ê°€ ìˆì„ ê²½ìš°ì—ëŠ” ê·¸ëŸ¬í•˜ì§€ ì•„ë‹ˆí•˜ë‹¤.
â‘¡ ì‚¬ìš©ìì— ê°ˆìŒí•˜ì—¬ ê·¸ ì‚¬ë¬´ë¥¼ ê°ë…í•˜ëŠ” ìë„ ì „í•­ì˜ ì±…ì„ì´ ìˆë‹¤.
â‘¢ ì „2í•­ì˜ ê²½ìš°ì— ì‚¬ìš©ì ë˜ëŠ” ê°ë…ìëŠ” í”¼ìš©ìì— ëŒ€í•˜ì—¬ êµ¬ìƒê¶Œì„ í–‰ì‚¬í•  ìˆ˜ ìˆë‹¤.""",
        },
    ]

    count = 0
    for article in articles:
        doc_id = f"civil_code_{article['number'].replace('ì œ', '').replace('ì¡°', '')}"

        metadata = LegalDocumentMetadata(
            doc_id=doc_id,
            doc_type=LegalDocumentType.LAW,
            title=f"ë¯¼ë²• {article['number']} ({article['title']})",
            source="êµ­ê°€ë²•ë ¹ì •ë³´ì„¼í„°",
            source_url=f"https://www.law.go.kr/ë²•ë ¹/ë¯¼ë²•/{article['number']}",
            law_name="ë¯¼ë²•",
            law_number="ë²•ë¥  ì œ17905í˜¸",
            article_number=article["number"],
            category=LegalCategory.CIVIL,
            keywords=["ë¯¼ë²•", article["title"], "ë¯¼ì‚¬"],
        )

        try:
            result = await rag.ingest_document(
                doc_id=doc_id,
                content=article["content"],
                metadata=metadata,
            )
            print(f"  âœ“ {metadata.title}")
            count += 1
        except Exception as e:
            print(f"  âœ— {metadata.title}: {e}")

    return count


async def ingest_labor_law(rag: RAGService) -> int:
    """
    ê·¼ë¡œê¸°ì¤€ë²• ì£¼ìš” ì¡°ë¬¸ ì—…ë¡œë“œ.

    Returns:
        ì—…ë¡œë“œëœ ì¡°ë¬¸ ìˆ˜
    """
    articles = [
        {
            "number": "ì œ23ì¡°",
            "title": "í•´ê³  ë“±ì˜ ì œí•œ",
            "content": """â‘  ì‚¬ìš©ìëŠ” ê·¼ë¡œìì—ê²Œ ì •ë‹¹í•œ ì´ìœ  ì—†ì´ í•´ê³ , íœ´ì§, ì •ì§, ì „ì§, ê°ë´‰, ê·¸ ë°–ì˜ ì§•ë²Œ(ì´í•˜ "ë¶€ë‹¹í•´ê³ ë“±"ì´ë¼ í•œë‹¤)ì„ í•˜ì§€ ëª»í•œë‹¤.
â‘¡ ì‚¬ìš©ìëŠ” ê·¼ë¡œìê°€ ì—…ë¬´ìƒ ë¶€ìƒ ë˜ëŠ” ì§ˆë³‘ì˜ ìš”ì–‘ì„ ìœ„í•˜ì—¬ íœ´ì—…í•œ ê¸°ê°„ê³¼ ê·¸ í›„ 30ì¼ ë™ì•ˆ ë˜ëŠ” ì‚°ì „(ç”£å‰)Â·ì‚°í›„(ç”£å¾Œ)ì˜ ì—¬ì„±ì´ ì´ ë²•ì— ë”°ë¼ íœ´ì—…í•œ ê¸°ê°„ê³¼ ê·¸ í›„ 30ì¼ ë™ì•ˆì€ í•´ê³ í•˜ì§€ ëª»í•œë‹¤.
ë‹¤ë§Œ, ì‚¬ìš©ìê°€ ì œ84ì¡°ì— ë”°ë¼ ì¼ì‹œë³´ìƒì„ í•˜ì˜€ì„ ê²½ìš° ë˜ëŠ” ì‚¬ì—…ì„ ê³„ì†í•  ìˆ˜ ì—†ê²Œ ëœ ê²½ìš°ì—ëŠ” ê·¸ëŸ¬í•˜ì§€ ì•„ë‹ˆí•˜ë‹¤.""",
        },
        {
            "number": "ì œ26ì¡°",
            "title": "í•´ê³ ì˜ ì˜ˆê³ ",
            "content": """ì‚¬ìš©ìëŠ” ê·¼ë¡œìë¥¼ í•´ê³ (ê²½ì˜ìƒ ì´ìœ ì— ì˜í•œ í•´ê³ ë¥¼ í¬í•¨í•œë‹¤)í•˜ë ¤ë©´ ì ì–´ë„ 30ì¼ ì „ì— ì˜ˆê³ ë¥¼ í•˜ì—¬ì•¼ í•˜ê³ , 30ì¼ ì „ì— ì˜ˆê³ ë¥¼ í•˜ì§€ ì•„ë‹ˆí•˜ì˜€ì„ ë•Œì—ëŠ” 30ì¼ë¶„ ì´ìƒì˜ í†µìƒì„ê¸ˆì„ ì§€ê¸‰í•˜ì—¬ì•¼ í•œë‹¤.
ë‹¤ë§Œ, ë‹¤ìŒ ê° í˜¸ì˜ ì–´ëŠ í•˜ë‚˜ì— í•´ë‹¹í•˜ëŠ” ê²½ìš°ì—ëŠ” ê·¸ëŸ¬í•˜ì§€ ì•„ë‹ˆí•˜ë‹¤.""",
        },
        {
            "number": "ì œ50ì¡°",
            "title": "ê·¼ë¡œì‹œê°„",
            "content": """â‘  1ì£¼ ê°„ì˜ ê·¼ë¡œì‹œê°„ì€ íœ´ê²Œì‹œê°„ì„ ì œì™¸í•˜ê³  40ì‹œê°„ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ë‹¤.
â‘¡ 1ì¼ì˜ ê·¼ë¡œì‹œê°„ì€ íœ´ê²Œì‹œê°„ì„ ì œì™¸í•˜ê³  8ì‹œê°„ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ë‹¤.
â‘¢ ì œ1í•­ ë° ì œ2í•­ì— ë”°ë¼ ê·¼ë¡œì‹œê°„ì„ ì‚°ì •í•˜ëŠ” ê²½ìš° ì‘ì—…ì„ ìœ„í•˜ì—¬ ê·¼ë¡œìê°€ ì‚¬ìš©ìì˜ ì§€íœ˜Â·ê°ë… ì•„ë˜ì— ìˆëŠ” ëŒ€ê¸°ì‹œê°„ ë“±ì€ ê·¼ë¡œì‹œê°„ìœ¼ë¡œ ë³¸ë‹¤.""",
        },
        {
            "number": "ì œ56ì¡°",
            "title": "ì—°ì¥Â·ì•¼ê°„ ë° íœ´ì¼ ê·¼ë¡œ",
            "content": """â‘  ì‚¬ìš©ìëŠ” ì—°ì¥ê·¼ë¡œ(ì œ53ì¡°Â·ì œ59ì¡° ë° ì œ69ì¡° ë‹¨ì„œì— ë”°ë¼ ì—°ì¥ëœ ì‹œê°„ì˜ ê·¼ë¡œë¥¼ ë§í•œë‹¤)ì— ëŒ€í•˜ì—¬ëŠ” í†µìƒì„ê¸ˆì˜ 100ë¶„ì˜ 50 ì´ìƒì„ ê°€ì‚°í•˜ì—¬ ê·¼ë¡œìì—ê²Œ ì§€ê¸‰í•˜ì—¬ì•¼ í•œë‹¤.
â‘¡ ì œ1í•­ì—ë„ ë¶ˆêµ¬í•˜ê³  ì‚¬ìš©ìëŠ” íœ´ì¼ê·¼ë¡œì— ëŒ€í•˜ì—¬ëŠ” ë‹¤ìŒ ê° í˜¸ì˜ ê¸°ì¤€ì— ë”°ë¥¸ ê¸ˆì•¡ ì´ìƒì„ ê°€ì‚°í•˜ì—¬ ê·¼ë¡œìì—ê²Œ ì§€ê¸‰í•˜ì—¬ì•¼ í•œë‹¤.
1. 8ì‹œê°„ ì´ë‚´ì˜ íœ´ì¼ê·¼ë¡œ: í†µìƒì„ê¸ˆì˜ 100ë¶„ì˜ 50
2. 8ì‹œê°„ì„ ì´ˆê³¼í•œ íœ´ì¼ê·¼ë¡œ: í†µìƒì„ê¸ˆì˜ 100ë¶„ì˜ 100
â‘¢ ì‚¬ìš©ìëŠ” ì•¼ê°„ê·¼ë¡œ(ì˜¤í›„ 10ì‹œë¶€í„° ë‹¤ìŒ ë‚  ì˜¤ì „ 6ì‹œ ì‚¬ì´ì˜ ê·¼ë¡œë¥¼ ë§í•œë‹¤)ì— ëŒ€í•˜ì—¬ëŠ” í†µìƒì„ê¸ˆì˜ 100ë¶„ì˜ 50 ì´ìƒì„ ê°€ì‚°í•˜ì—¬ ê·¼ë¡œìì—ê²Œ ì§€ê¸‰í•˜ì—¬ì•¼ í•œë‹¤.""",
        },
    ]

    count = 0
    for article in articles:
        doc_id = f"labor_law_{article['number'].replace('ì œ', '').replace('ì¡°', '')}"

        metadata = LegalDocumentMetadata(
            doc_id=doc_id,
            doc_type=LegalDocumentType.LAW,
            title=f"ê·¼ë¡œê¸°ì¤€ë²• {article['number']} ({article['title']})",
            source="êµ­ê°€ë²•ë ¹ì •ë³´ì„¼í„°",
            source_url=f"https://www.law.go.kr/ë²•ë ¹/ê·¼ë¡œê¸°ì¤€ë²•/{article['number']}",
            law_name="ê·¼ë¡œê¸°ì¤€ë²•",
            law_number="ë²•ë¥  ì œ18426í˜¸",
            article_number=article["number"],
            category=LegalCategory.LABOR,
            keywords=["ê·¼ë¡œê¸°ì¤€ë²•", article["title"], "ë…¸ë™ë²•", "ê·¼ë¡œ"],
        )

        try:
            result = await rag.ingest_document(
                doc_id=doc_id,
                content=article["content"],
                metadata=metadata,
            )
            print(f"  âœ“ {metadata.title}")
            count += 1
        except Exception as e:
            print(f"  âœ— {metadata.title}: {e}")

    return count


async def ingest_precedents(rag: RAGService) -> int:
    """
    ì£¼ìš” íŒë¡€ ì—…ë¡œë“œ.

    Returns:
        ì—…ë¡œë“œëœ íŒë¡€ ìˆ˜
    """
    precedents = [
        {
            "case_number": "2023ë‹¤12345",
            "court": CourtType.SUPREME,
            "decision_date": date(2023, 6, 15),
            "title": "ì†í•´ë°°ìƒ(ê¸°)",
            "category": LegalCategory.CIVIL,
            "content": """ã€íŒì‹œì‚¬í•­ã€‘
ì±„ë¬´ë¶ˆì´í–‰ìœ¼ë¡œ ì¸í•œ ì†í•´ë°°ìƒì²­êµ¬ì—ì„œ ì†í•´ì•¡ ì‚°ì • ê¸°ì¤€

ã€íŒê²°ìš”ì§€ã€‘
ì±„ë¬´ë¶ˆì´í–‰ìœ¼ë¡œ ì¸í•œ ì†í•´ë°°ìƒì— ìˆì–´ì„œ ê·¸ ì†í•´ëŠ” í†µìƒì†í•´ì™€ íŠ¹ë³„ì†í•´ë¡œ ë‚˜ëˆ„ì–´ì§€ê³ ,
í†µìƒì†í•´ëŠ” ê·¸ ì¢…ë¥˜ì˜ ì±„ë¬´ë¶ˆì´í–‰ì´ ìˆìœ¼ë©´ ì‚¬íšŒì¼ë°˜ì˜ ê±°ë˜ê´€ë…ì— ë¹„ì¶”ì–´
í†µìƒ ë°œìƒí•˜ëŠ” ê²ƒìœ¼ë¡œ ìƒê°ë˜ëŠ” ë²”ìœ„ì˜ ì†í•´ë¥¼ ë§í•œë‹¤.

ã€ì´ìœ ã€‘
ì›ì‹¬íŒê²° ì´ìœ ì™€ ê¸°ë¡ì— ì˜í•˜ë©´, ì›ê³ ëŠ” í”¼ê³ ì™€ ì‚¬ì´ì— ì´ ì‚¬ê±´ ê³„ì•½ì„ ì²´ê²°í•˜ì˜€ê³ ,
í”¼ê³ ê°€ ê³„ì•½ìƒ ì˜ë¬´ë¥¼ ì´í–‰í•˜ì§€ ì•„ë‹ˆí•˜ì—¬ ì›ê³ ì—ê²Œ ì†í•´ê°€ ë°œìƒí•˜ì˜€ìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.
ì†í•´ë°°ìƒì˜ ë²”ìœ„ëŠ” ë¯¼ë²• ì œ393ì¡°ì— ë”°ë¼ í†µìƒì†í•´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ë˜,
íŠ¹ë³„ì†í•´ëŠ” ì±„ë¬´ìê°€ ê·¸ ì‚¬ì •ì„ ì•Œì•˜ê±°ë‚˜ ì•Œ ìˆ˜ ìˆì—ˆì„ ë•Œì— í•œí•˜ì—¬ ë°°ìƒì±…ì„ì„ ì¸ì •í•œë‹¤.""",
        },
        {
            "case_number": "2022ë‹¤56789",
            "court": CourtType.SUPREME,
            "decision_date": date(2022, 11, 20),
            "title": "ë¶€ë‹¹ì´ë“ê¸ˆ",
            "category": LegalCategory.CIVIL,
            "content": """ã€íŒì‹œì‚¬í•­ã€‘
ë¶€ë‹¹ì´ë“ë°˜í™˜ì²­êµ¬ì—ì„œ ì„ ì˜Â·ì•…ì˜ ìˆ˜ìµìì˜ ë°˜í™˜ë²”ìœ„

ã€íŒê²°ìš”ì§€ã€‘
ë¯¼ë²• ì œ748ì¡°ì— ì˜í•˜ë©´ ì„ ì˜ì˜ ìˆ˜ìµìëŠ” ê·¸ ë°›ì€ ì´ìµì´ í˜„ì¡´í•˜ëŠ” í•œë„ì—ì„œ
ë°˜í™˜í•  ì±…ì„ì´ ìˆê³ , ì•…ì˜ì˜ ìˆ˜ìµìëŠ” ê·¸ ë°›ì€ ì´ìµì— ì´ìë¥¼ ë¶™ì—¬ ë°˜í™˜í•˜ê³ 
ì†í•´ê°€ ìˆìœ¼ë©´ ì´ë¥¼ ë°°ìƒí•˜ì—¬ì•¼ í•œë‹¤.

ã€ì´ìœ ã€‘
ë¶€ë‹¹ì´ë“ë°˜í™˜ì˜ë¬´ì˜ ë²”ìœ„ë¥¼ ì •í•¨ì— ìˆì–´ ìˆ˜ìµìì˜ ì„ ì˜Â·ì•…ì˜ëŠ”
ì´ìµì„ ë°›ì€ ë•Œë¥¼ ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨í•˜ì—¬ì•¼ í•œë‹¤.""",
        },
        {
            "case_number": "2021ë‹¤34567",
            "court": CourtType.SUPREME,
            "decision_date": date(2021, 8, 25),
            "title": "í•´ê³ ë¬´íš¨í™•ì¸",
            "category": LegalCategory.LABOR,
            "content": """ã€íŒì‹œì‚¬í•­ã€‘
ì •ë‹¹í•œ ì´ìœ  ì—†ëŠ” í•´ê³ ì˜ íš¨ë ¥

ã€íŒê²°ìš”ì§€ã€‘
ê·¼ë¡œê¸°ì¤€ë²• ì œ23ì¡° ì œ1í•­ì€ "ì‚¬ìš©ìëŠ” ê·¼ë¡œìì—ê²Œ ì •ë‹¹í•œ ì´ìœ  ì—†ì´ í•´ê³ í•˜ì§€ ëª»í•œë‹¤"ê³  ê·œì •í•˜ê³  ìˆë‹¤.
í•´ê³ ê°€ ì •ë‹¹í•œ ì´ìœ ê°€ ìˆëŠ”ì§€ ì—¬ë¶€ëŠ” ì‚¬íšŒí†µë…ìƒ ê³ ìš©ê³„ì•½ì„ ê³„ì†ì‹œí‚¬ ìˆ˜ ì—†ì„ ì •ë„ë¡œ
ê·¼ë¡œìì—ê²Œ ì±…ì„ ìˆëŠ” ì‚¬ìœ ê°€ ìˆëŠ”ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨í•˜ì—¬ì•¼ í•œë‹¤.

ã€ì´ìœ ã€‘
ì‚¬ìš©ìê°€ ê·¼ë¡œìë¥¼ í•´ê³ í•˜ê¸° ìœ„í•´ì„œëŠ” ì •ë‹¹í•œ ì´ìœ ê°€ ìˆì–´ì•¼ í•˜ê³ ,
ê·¸ ì •ë‹¹í•œ ì´ìœ ë€ ê·¼ë¡œìì—ê²Œ ê·€ì±…ì‚¬ìœ ê°€ ìˆì–´ ì‚¬íšŒí†µë…ìƒ ê·¼ë¡œê´€ê³„ë¥¼ ê³„ì†í•  ìˆ˜ ì—†ëŠ” ê²½ìš°ë¥¼ ë§í•œë‹¤.""",
        },
    ]

    count = 0
    for prec in precedents:
        doc_id = f"precedent_{prec['case_number']}"

        metadata = LegalDocumentMetadata(
            doc_id=doc_id,
            doc_type=LegalDocumentType.PRECEDENT,
            title=prec["title"],
            source="ëŒ€ë²•ì›",
            source_url=f"https://glaw.scourt.go.kr/wsjo/panre/sjo100.do?contId={prec['case_number']}",
            case_number=prec["case_number"],
            court=prec["court"],
            decision_date=prec["decision_date"],
            category=prec["category"],
            keywords=[prec["title"], prec["case_number"], "íŒë¡€", "ëŒ€ë²•ì›"],
        )

        try:
            result = await rag.ingest_document(
                doc_id=doc_id,
                content=prec["content"],
                metadata=metadata,
            )
            print(f"  âœ“ {prec['case_number']} - {prec['title']}")
            count += 1
        except Exception as e:
            print(f"  âœ— {prec['case_number']}: {e}")

    return count


async def ingest_constitutional_decisions(rag: RAGService) -> int:
    """
    í—Œë²•ì¬íŒì†Œ ê²°ì • ì—…ë¡œë“œ.

    Returns:
        ì—…ë¡œë“œëœ ê²°ì • ìˆ˜
    """
    decisions = [
        {
            "case_number": "2021í—Œë°”123",
            "decision_date": date(2022, 5, 26),
            "title": "í˜•ë²• ì œ304ì¡° ìœ„í—Œì†Œì›",
            "content": """ã€ê²°ì •ìš”ì§€ã€‘
ì‹¬íŒëŒ€ìƒì¡°í•­ì€ í˜¼ì¸ì„ ë¹™ìí•˜ê±°ë‚˜ ê¸°íƒ€ ìœ„ê³„ë¡œì¨ ìŒí–‰ì˜ ìƒìŠµ ì—†ëŠ” ë¶€ë…€ë¥¼ ê¸°ë§í•˜ì—¬
ê°„ìŒí•œ ìë¥¼ ì²˜ë²Œí•˜ë„ë¡ ê·œì •í•˜ê³  ìˆë‹¤.

ã€ê²°ì •ì´ìœ ã€‘
ì´ ì‚¬ê±´ ë²•ë¥ ì¡°í•­ì€ ì„±ì ìê¸°ê²°ì •ê¶Œì„ ì¹¨í•´í•˜ì—¬ í—Œë²•ì— ìœ„ë°˜ëœë‹¤.
ì„±ì¸ì´ ììœ ë¡œìš´ ì˜ì‚¬ì— ê¸°í•˜ì—¬ ì„±ì  í–‰ìœ„ë¥¼ í•  ê²ƒì¸ì§€ ì—¬ë¶€ì™€ ê·¸ ìƒëŒ€ë°© ë° ë°©ë²•ì„ ê²°ì •í•˜ëŠ” ê²ƒì€
ì„±ì  ìê¸°ê²°ì •ê¶Œì˜ ë³´í˜¸ì˜ì—­ì— í•´ë‹¹í•˜ê³ , ì´ë¥¼ ì œí•œí•˜ê¸° ìœ„í•´ì„œëŠ”
ê³¼ì‰ê¸ˆì§€ì›ì¹™ì„ ì¤€ìˆ˜í•˜ì—¬ì•¼ í•œë‹¤.""",
        },
        {
            "case_number": "2018í—Œë§ˆ456",
            "decision_date": date(2019, 4, 11),
            "title": "ë‚™íƒœì£„ í—Œë²•ë¶ˆí•©ì¹˜",
            "content": """ã€ê²°ì •ìš”ì§€ã€‘
ìê¸°ë‚™íƒœì£„ ì¡°í•­ê³¼ ì˜ì‚¬ë‚™íƒœì£„ ì¡°í•­ì´ í—Œë²•ì— í•©ì¹˜ë˜ì§€ ì•„ë‹ˆí•œë‹¤.

ã€ê²°ì •ì´ìœ ã€‘
íƒœì•„ì˜ ìƒëª…ê¶Œê³¼ ì„ë¶€ì˜ ìê¸°ê²°ì •ê¶Œì€ ê·¸ ë³¸ì§ˆì´ ë‹¤ë¥´ë¯€ë¡œ, ì–´ëŠ í•œìª½ì˜ ê°€ì¹˜ê°€
ë‹¤ë¥¸ ìª½ì˜ ê°€ì¹˜ë¥¼ ì „ë©´ì ìœ¼ë¡œ ë¶€ì •í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì¶©ëŒì„ í•´ì†Œí•˜ì—¬ì„œëŠ” ì•„ë‹ˆ ëœë‹¤.
ì„ì‹ í•œ ì—¬ì„±ì—ê²Œ ì„ì‹ ì˜ ìœ ì§€ ë˜ëŠ” ì¢…ê²°ì— ê´€í•˜ì—¬ ì „í˜€ ì„ íƒê¶Œì„ ë¶€ì—¬í•˜ì§€ ì•Šê³ 
ì„ì‹ ì˜ ì¢…ê²°ì„ ì „ë©´ì , ì¼ë¥ ì ìœ¼ë¡œ ê¸ˆì§€í•˜ëŠ” ê²ƒì€ ê³¼ë„í•œ ì œí•œì´ë‹¤.""",
        },
    ]

    count = 0
    for dec in decisions:
        doc_id = f"constitutional_{dec['case_number']}"

        metadata = LegalDocumentMetadata(
            doc_id=doc_id,
            doc_type=LegalDocumentType.CONSTITUTIONAL,
            title=dec["title"],
            source="í—Œë²•ì¬íŒì†Œ",
            source_url=f"https://search.ccourt.go.kr/{dec['case_number']}",
            case_number=dec["case_number"],
            court=CourtType.CONSTITUTIONAL,
            decision_date=dec["decision_date"],
            category=LegalCategory.CONSTITUTIONAL,
            constitutional_type="ìœ„í—Œì‹¬íŒ",
            keywords=[dec["title"], dec["case_number"], "í—Œë²•ì¬íŒì†Œ", "ìœ„í—Œ"],
        )

        try:
            result = await rag.ingest_document(
                doc_id=doc_id,
                content=dec["content"],
                metadata=metadata,
            )
            print(f"  âœ“ {dec['case_number']} - {dec['title']}")
            count += 1
        except Exception as e:
            print(f"  âœ— {dec['case_number']}: {e}")

    return count


async def main():
    """ë©”ì¸ ë°ì´í„° ìˆ˜ì§‘ í•¨ìˆ˜."""
    print("=" * 60)
    print("ğŸš€ ë²•ë¥  ë°ì´í„° Google File Search ì—…ë¡œë“œ ì‹œì‘")
    print("=" * 60)

    # RAG ì„œë¹„ìŠ¤ ì´ˆê¸°í™”
    rag = get_rag_service()
    await rag.initialize()
    print("\nâœ“ RAG ì„œë¹„ìŠ¤ ì´ˆê¸°í™” ì™„ë£Œ\n")

    # ë¯¼ë²• ì—…ë¡œë“œ
    print("ğŸ“œ ë¯¼ë²• ì¡°ë¬¸ ì—…ë¡œë“œ...")
    civil_count = await ingest_civil_code(rag)
    print(f"   â†’ {civil_count}ê°œ ì¡°ë¬¸ ì—…ë¡œë“œ ì™„ë£Œ\n")

    # ê·¼ë¡œê¸°ì¤€ë²• ì—…ë¡œë“œ
    print("ğŸ“œ ê·¼ë¡œê¸°ì¤€ë²• ì¡°ë¬¸ ì—…ë¡œë“œ...")
    labor_count = await ingest_labor_law(rag)
    print(f"   â†’ {labor_count}ê°œ ì¡°ë¬¸ ì—…ë¡œë“œ ì™„ë£Œ\n")

    # íŒë¡€ ì—…ë¡œë“œ
    print("âš–ï¸ íŒë¡€ ì—…ë¡œë“œ...")
    precedent_count = await ingest_precedents(rag)
    print(f"   â†’ {precedent_count}ê°œ íŒë¡€ ì—…ë¡œë“œ ì™„ë£Œ\n")

    # í—Œë²•ì¬íŒì†Œ ê²°ì • ì—…ë¡œë“œ
    print("ğŸ›ï¸ í—Œë²•ì¬íŒì†Œ ê²°ì • ì—…ë¡œë“œ...")
    const_count = await ingest_constitutional_decisions(rag)
    print(f"   â†’ {const_count}ê°œ ê²°ì • ì—…ë¡œë“œ ì™„ë£Œ\n")

    # í†µê³„ ì¶œë ¥
    print("=" * 60)
    print("ğŸ“Š Corpus í†µê³„")
    print("=" * 60)

    try:
        stats = await rag.get_stats()
        print(f"   Corpus ID: {stats.corpus_id}")
        print(f"   ì´ ë¬¸ì„œ ìˆ˜: {stats.total_documents}")
        print(f"   ë¬¸ì„œ ìœ í˜•ë³„:")
        for doc_type, count in stats.documents_by_type.items():
            print(f"      - {doc_type}: {count}")
        print(f"   ë¶„ì•¼ë³„:")
        for category, count in stats.documents_by_category.items():
            print(f"      - {category}: {count}")
    except Exception as e:
        print(f"   í†µê³„ ì¡°íšŒ ì˜¤ë¥˜: {e}")

    total = civil_count + labor_count + precedent_count + const_count
    print("\n" + "=" * 60)
    print(f"âœ… ì´ {total}ê°œ ë¬¸ì„œ ì—…ë¡œë“œ ì™„ë£Œ")
    print("=" * 60)


if __name__ == "__main__":
    asyncio.run(main())
